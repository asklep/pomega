<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pomega Nöbet Listesi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root { --pomega-blue: #0056b3; }
        body { background-color: #f4f4f9; font-family: sans-serif; }
        .header { background: var(--pomega-blue); color: white; padding: 20px; text-align: center; border-radius: 0 0 20px 20px; }
        .search-box { margin: -20px auto 20px; max-width: 500px; }
        .search-box input { border-radius: 25px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); border: none; padding: 12px 20px; }
        .table-container { background: white; border-radius: 15px; box-shadow: 0 0 15px rgba(0,0,0,0.05); margin: 20px; overflow: hidden; }
        .table-responsive { max-height: 75vh; overflow: auto; }
        table { width: 100%; border-collapse: collapse; }
        th { background: #eee; position: sticky; top: 0; z-index: 10; padding: 10px; font-size: 12px; border: 1px solid #ddd; }
        td { padding: 8px; border: 1px solid #eee; text-align: center; font-size: 14px; }
        .fixed-name { position: sticky; left: 0; background: white; z-index: 5; font-weight: bold; text-align: left; min-width: 150px; border-right: 2px solid #ddd; }
        .n1 { background: #ff4d4d !important; color: white; font-weight: bold; border-radius: 4px; }
        .n2 { background: #ffcc00 !important; color: black; font-weight: bold; border-radius: 4px; }
        .weekend { background-color: #fff0f0; }
    </style>
</head>
<body>

<div class="header">
    <h2>Pomega Nöbet Listesi</h2>
    <p id="status">Veriler yükleniyor...</p>
</div>

<div class="container search-box">
    <input type="text" id="searchInput" class="form-control" placeholder="İsim ara..." onkeyup="filter()">
</div>

<div class="table-container">
    <div class="table-responsive">
        <table id="nobetTable">
            <thead id="thead"></thead>
            <tbody id="tbody"></tbody>
        </table>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
<script>
    const url = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTHPuchO7TrhvUmDLHNlEvgX_5Mt8J0L0L0RTERIjaL763MY4Hr3Tt1SWIxkbjgjDoum-N-PyrcO_KC/pub?gid=1602899784&single=true&output=csv';

    function loadData() {
        Papa.parse(url, {
            download: true,
            header: false,
            complete: function(results) {
                if (results.data && results.data.length > 0) {
                    render(results.data);
                    document.getElementById('status').innerText = "Ocak 2026 (Güncel)";
                } else {
                    document.getElementById('status').innerText = "Veri bulunamadı!";
                }
            },
            error: function(err) {
                document.getElementById('status').innerText = "Hata: Veri çekilemedi.";
                console.error(err);
            }
        });
    }

    function render(data) {
        const thead = document.getElementById('thead');
        const tbody = document.getElementById('tbody');

        // Başlık (Günler)
        let h = '<tr><th class="fixed-name">PERSONEL ADI</th>';
        for (let j = 1; j <= 31; j++) {
            let gunNo = data[0][j] || j;
            let gunAdi = data[1][j] || '';
            let wk = (gunAdi === 'cmt' || gunAdi === 'paz') ? 'weekend' : '';
            h += `<th class="${wk}">${gunNo}<br>${gunAdi}</th>`;
        }
        h += '</tr>';
        thead.innerHTML = h;

        // Satırlar
        let b = '';
        for (let i = 2; i < data.length; i++) {
            if (!data[i][0]) continue;
            b += '<tr>';
            b += `<td class="fixed-name">${data[i][0]}</td>`;
            for (let j = 1; j <= 31; j++) {
                let val = data[i][j] ? data[i][j].trim() : '';
                let cl = '';
                if(val === '1') cl = 'n1';
                if(val === '2') cl = 'n2';
                let gunAdi = data[1][j] || '';
                let wk = (gunAdi === 'cmt' || gunAdi === 'paz') ? 'weekend' : '';
                b += `<td class="${wk} ${cl}">${val}</td>`;
            }
            b += '</tr>';
        }
        tbody.innerHTML = b;
    }

    function filter() {
        let val = document.getElementById('searchInput').value.toUpperCase();
        let rows = document.getElementById('tbody').getElementsByTagName('tr');
        for (let i = 0; i < rows.length; i++) {
            let name = rows[i].getElementsByTagName('td')[0].innerText;
            rows[i].style.display = name.toUpperCase().includes(val) ? "" : "none";
        }
    }

    window.onload = loadData;
</script>
</body>
</html>
